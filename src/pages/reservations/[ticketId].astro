---
import Ticket from "../../components/ticket/Ticket.astro";
import Layout from "../../layouts/Layout.astro";
export const prerender = false;

const API_URL = import.meta.env.PUBLIC_API_URL;
const { ticketId } = Astro.params;

const response = await fetch(`${API_URL}/tickets/${ticketId}`);
const ticketData = await response.json();
console.log("ok", response.ok);
const { id, name, reservationDate, seatCode, travelFrom, travelTo } =
  ticketData;

const parsedReservationDate = new Date(reservationDate).toLocaleDateString(
  "en-US",
  {
    day: "2-digit",
    month: "short",
    timeZone: "GMT",
  },
);

const seatWindow =
  seatCode?.includes("1") || seatCode?.includes("4") ? "Yes" : "No";
---

<Layout title="My Ticket | PlanetX Adventures">
  <main class="my-ticket-container">
    <Ticket
      id={id}
      ticketName={name}
      reservationDate={parsedReservationDate}
      seatCode={seatCode}
      seatWindow={seatWindow}
      travelFrom={travelFrom}
      travelTo={travelTo}
    />
    <a href="/" class="go-home-button"> Go Home</a>
  </main>
</Layout>

<style>
  .my-ticket-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-image: url("../../assets/background-reservations.jpg");
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
    padding: 4rem 1rem;
    gap: 2rem;
  }

  .go-home-button {
    background-color: var(--white);
    color: var(--black);
    padding: 0.75rem 1.5rem;
    border-radius: 2rem;
    border: none;
    font-weight: 500;
    font-size: 1rem;
    transition:
      background-color 0.2s,
      color 0.2s,
      box-shadow 0.2s;
  }

  .go-home-button:hover {
    background-color: var(--black);
    color: var(--white);
    box-shadow: 0 0 8px 1px var(--black);
  }

  .ticket-not-found {
    color: var(--white);
    text-align: center;
    font-size: 1.25rem;
    background-color: var(--dark-blue);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 2rem;
  }

  .ticket-not-found-text {
    font-size: 2rem;
    text-transform: uppercase;
  }

  .ticket-not-found-text p:nth-child(1) {
    font-size: 4rem;
  }

  #rocket-fire {
    animation-name: rocket-fire;
    animation-duration: 1s;
    animation-iteration-count: infinite;
    animation-fill-mode: both;
    animation-direction: alternate;
    animation-timing-function: linear;
  }

  .rocket {
    animation-name: rocket-move;
    animation-duration: 1s;
    animation-iteration-count: infinite;
    animation-fill-mode: both;
    animation-direction: alternate;
    animation-timing-function: ease-in-out;
  }

  @keyframes rocket-fire {
    from {
      transform: translate(1px, -1px);
    }
    to {
      transform: translate(2px, -2px);
    }
  }

  @keyframes rocket-move {
    from {
      transform: translate(0);
    }
    to {
      transform: translate(2px, -2px);
    }
  }
</style>
